# Makefile para Parser LL(1) Personalizado en C
# GramÃ¡tica: E -> T E' | E' -> + T E' | Îµ | T -> F T' | T' -> * F T' | Îµ | F -> ( E ) | ident

CC = gcc
CFLAGS = -Wall -Wextra -std=c99 -g -O2
TARGET = parser
SOURCES = main.c lexer.c parser.c
HEADERS = lexer.h parser.h
OBJECTS = $(SOURCES:.c=.o)

# Archivos de prueba
TEST_INPUT = test_input.txt
TEST_ERRORS = test_errores.txt
EXAMPLES = ejemplos.txt

.PHONY: all run test clean test-errors test-all info check-tools help debug

# Regla principal
all: check-tools $(TARGET)
	@echo "âœ… CompilaciÃ³n completada exitosamente"
	@echo "ðŸ“‹ Ejecuta 'make run' para probar el parser"
	@echo "ðŸ“‹ Ejecuta 'make test' para ejecutar las pruebas"

# Compilar el parser
$(TARGET): $(OBJECTS)
	@echo "ðŸ”¨ Enlazando parser LL(1)..."
	$(CC) $(CFLAGS) -o $(TARGET) $(OBJECTS)
	@echo "âœ… Parser compilado: $(TARGET)"

# Compilar archivos objeto
%.o: %.c $(HEADERS)
	@echo "ðŸ”§ Compilando $<..."
	$(CC) $(CFLAGS) -c $< -o $@

# Ejecutar el parser interactivamente
run: $(TARGET)
	@echo "ðŸš€ Ejecutando parser LL(1) en modo interactivo:"
	@echo "ðŸ“ Ejemplos vÃ¡lidos: a, a+b, a*b, (a+b)*c, a+b*c"
	@echo "ðŸ“ Escriba 'salir' para terminar"
	./$(TARGET)

# Ejecutar pruebas con casos vÃ¡lidos
test: $(TARGET) $(TEST_INPUT)
	@echo "ðŸ§ª Ejecutando pruebas con casos vÃ¡lidos..."
	@echo "ðŸ“ Archivo de prueba: $(TEST_INPUT)"
	@echo "========================================"
	@if [ -f $(TEST_INPUT) ]; then \
		./$(TARGET) $(TEST_INPUT); \
	else \
		echo "âŒ Archivo $(TEST_INPUT) no encontrado"; \
	fi

# Ejecutar pruebas con casos de error
test-errors: $(TARGET) $(TEST_ERRORS)
	@echo "ðŸ§ª Ejecutando pruebas con casos de error..."
	@echo "ðŸ“ Archivo de prueba: $(TEST_ERRORS)"
	@echo "========================================"
	@if [ -f $(TEST_ERRORS) ]; then \
		./$(TARGET) $(TEST_ERRORS); \
	else \
		echo "âŒ Archivo $(TEST_ERRORS) no encontrado"; \
	fi

# Ejecutar todas las pruebas
test-all: test test-errors
	@echo "âœ… Todas las pruebas completadas"

# Probar expresiÃ³n especÃ­fica
test-expr: $(TARGET)
	@echo "ðŸ§ª Probando expresiÃ³n especÃ­fica..."
	@read -p "Ingrese la expresiÃ³n: " expr; \
	./$(TARGET) -e "$$expr"

# Mostrar ejemplos
ejemplos: $(EXAMPLES)
	@echo "ðŸ“š Ejemplos de uso del parser LL(1):"
	@echo "======================================"
	@if [ -f $(EXAMPLES) ]; then \
		cat $(EXAMPLES); \
	else \
		echo "âŒ Archivo $(EXAMPLES) no encontrado"; \
	fi

# Compilar en modo debug
debug: CFLAGS += -DDEBUG -g3
debug: clean $(TARGET)
	@echo "ðŸ› Parser compilado en modo debug"

# Limpiar archivos generados
clean:
	@echo "ðŸ§¹ Limpiando archivos generados..."
	rm -f $(TARGET) $(OBJECTS)
	rm -rf $(TARGET).dSYM
	@echo "âœ… Limpieza completada"

# Verificar herramientas necesarias
check-tools:
	@echo "ðŸ” Verificando herramientas necesarias..."
	@which $(CC) > /dev/null || (echo "âŒ $(CC) no encontrado" && exit 1)
	@echo "âœ… Todas las herramientas estÃ¡n disponibles"

# Mostrar informaciÃ³n del proyecto
info:
	@echo "ðŸ“‹ INFORMACIÃ“N DEL PROYECTO"
	@echo "=========================="
	@echo "Proyecto: Parser LL(1) Personalizado en C"
	@echo "GramÃ¡tica implementada:"
	@echo "  E  -> T E'"
	@echo "  E' -> + T E' | Îµ"
	@echo "  T  -> F T'"
	@echo "  T' -> * F T' | Îµ"
	@echo "  F  -> ( E ) | ident"
	@echo ""
	@echo "Archivos fuente:"
	@echo "  - main.c: Programa principal"
	@echo "  - lexer.c/lexer.h: Analizador lÃ©xico"
	@echo "  - parser.c/parser.h: Analizador sintÃ¡ctico"
	@echo ""
	@echo "CaracterÃ­sticas:"
	@echo "  - ImplementaciÃ³n completamente manual"
	@echo "  - Manejo detallado de errores"
	@echo "  - ConstrucciÃ³n de Ã¡rbol sintÃ¡ctico"
	@echo "  - MÃºltiples modos de ejecuciÃ³n"
	@echo ""
	@echo "Herramientas requeridas:"
	@echo "  - gcc: Compilador C"

# Mostrar ayuda
help:
	@echo "ðŸ“– AYUDA - Parser LL(1) Personalizado en C"
	@echo "=========================================="
	@echo ""
	@echo "COMANDOS PRINCIPALES:"
	@echo "  make all          Compilar el proyecto completo"
	@echo "  make run          Ejecutar el parser interactivamente"
	@echo "  make test         Ejecutar pruebas con casos vÃ¡lidos"
	@echo "  make test-errors  Ejecutar pruebas con casos de error"
	@echo "  make test-all     Ejecutar todas las pruebas"
	@echo "  make test-expr    Probar una expresiÃ³n especÃ­fica"
	@echo "  make clean        Limpiar archivos generados"
	@echo ""
	@echo "COMANDOS DE DESARROLLO:"
	@echo "  make debug        Compilar en modo debug"
	@echo "  make check-tools  Verificar herramientas necesarias"
	@echo ""
	@echo "COMANDOS DE INFORMACIÃ“N:"
	@echo "  make info         Mostrar informaciÃ³n del proyecto"
	@echo "  make ejemplos     Mostrar ejemplos de uso"
	@echo "  make help         Mostrar esta ayuda"
	@echo ""
	@echo "MODOS DE EJECUCIÃ“N:"
	@echo "  ./parser                    # Modo interactivo"
	@echo "  ./parser archivo.txt        # Procesar archivo"
	@echo "  ./parser -e \"a + b * c\"     # ExpresiÃ³n directa"
	@echo ""
	@echo "EJEMPLOS DE USO:"
	@echo "  ExpresiÃ³n simple:     a"
	@echo "  Suma:                 a + b"
	@echo "  MultiplicaciÃ³n:       a * b"
	@echo "  ExpresiÃ³n compleja:   (a + b) * c"
	@echo "  Precedencia:          a + b * c"

# Reglas de dependencias
main.o: main.c parser.h lexer.h
lexer.o: lexer.c lexer.h
parser.o: parser.c parser.h lexer.h